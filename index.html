<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Elite English Pro · Ultimate Edition</title>

<!-- ================= FONTS & ICONS ================= -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
/* =====================================================
   THEME · PREMIUM MOBILE APP
===================================================== */
:root{
--bg:#f8fafc;
--card:#ffffff;
--accent:#2563eb;
--accent-soft:#eff6ff;
--text:#020617;
--muted:#64748b;
--border:#e5e7eb;
--ok:#16a34a;
--bad:#dc2626;
--shadow:0 12px 30px rgba(0,0,0,.08);
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{
margin:0;
font-family:Inter;
background:var(--bg);
color:var(--text);
padding-bottom:90px;
}

/* ================= HEADER ================= */
header{
height:64px;
display:flex;
align-items:center;
justify-content:center;
font-weight:800;
background:white;
border-bottom:1px solid var(--border);
position:sticky;top:0;z-index:10;
}

/* ================= CONTAINER ================= */
.container{padding:20px}

/* ================= CARD ================= */
.card{
background:var(--card);
border-radius:24px;
padding:26px;
margin-bottom:26px;
box-shadow:var(--shadow);
}
.badge{
font-size:.65rem;
font-weight:800;
letter-spacing:.18em;
color:var(--accent);
margin-bottom:12px;
}
.text-en{
font-size:1.75rem;
font-weight:700;
line-height:1.35;
}
.text-fig{
background:var(--accent-soft);
padding:14px;
border-radius:14px;
margin-top:14px;
font-family:monospace;
}
.text-es{
margin-top:10px;
color:var(--muted);
line-height:1.4;
}

/* ================= BUTTONS ================= */
.controls{display:flex;gap:12px;margin-top:18px}
.btn-icon{
width:50px;height:50px;
border-radius:50%;
border:none;
background:var(--accent);
color:white;
font-size:1.1rem;
}
.btn-main{
margin-top:22px;
width:100%;
padding:16px;
border-radius:18px;
border:none;
background:var(--accent);
color:white;
font-weight:800;
font-size:1rem;
}

/* ================= SPEAK ================= */
.word-ok{color:var(--ok);font-weight:700}
.word-bad{color:var(--bad);font-weight:700}

/* ================= EXERCISES ================= */
.option{
padding:16px;
border-radius:16px;
border:1px solid var(--border);
margin-top:12px;
background:white;
cursor:pointer;
}
.correct{background:#ecfdf5;color:var(--ok)}
.wrong{background:#fef2f2;color:var(--bad)}

/* ================= TRANSLATOR ================= */
.trans-box{
margin-top:14px;
padding:16px;
border-radius:16px;
background:#f1f5f9;
font-size:1.05rem;
line-height:1.5;
}
.trans-meta{
font-size:.7rem;
color:var(--muted);
margin-top:8px;
}

/* ================= FORMS ================= */
input,textarea,select{
width:100%;
padding:14px;
border-radius:14px;
border:1px solid var(--border);
margin-top:10px;
font-family:Inter;
font-size:1rem;
}
textarea{min-height:120px}

/* ================= TABS ================= */
.tab{display:none}
.tab.active{display:block}

/* ================= NAV ================= */
nav{
position:fixed;bottom:0;left:0;right:0;
height:82px;background:white;
border-top:1px solid var(--border);
display:flex;justify-content:space-around;align-items:center;
}
nav div{
display:flex;flex-direction:column;align-items:center;
font-size:.65rem;font-weight:700;color:var(--muted);
}
nav .active{color:var(--accent)}
nav i{font-size:1.6rem}
</style>
</head>

<body>

<header>Elite English Pro</header>

<div class="container">

<!-- ================= PHRASES ================= -->
<section id="phrases" class="tab active">
<div class="card">
<div class="badge">PHRASES · REAL ENGLISH</div>
<div id="phEn" class="text-en"></div>
<div id="phFig" class="text-fig"></div>
<div id="phEs" class="text-es"></div>

<div class="controls">
<button class="btn-icon" onclick="tts(phEn.innerText,1)"><i class="fas fa-play"></i></button>
<button class="btn-icon" onclick="tts(phEn.innerText,.6)"><i class="fas fa-snail"></i></button>
</div>

<button class="btn-main" onclick="loadPhrase()">New Phrase</button>
</div>
</section>

<!-- ================= SPEAK ================= -->
<section id="speak" class="tab">
<div class="card">
<div class="badge">SPEAK · PRONUNCIATION ANALYSIS</div>
<div id="spTarget" class="text-en"></div>
<div id="spFig" class="text-fig"></div>
<div id="spResult"></div>
<div id="spScore" class="text-es"></div>

<div class="controls">
<button class="btn-icon" onclick="tts(spTarget.innerText,1)"><i class="fas fa-play"></i></button>
<button class="btn-icon" onclick="startSpeak()"><i class="fas fa-microphone"></i></button>
</div>

<button class="btn-main" onclick="generateSpeak()">New Speak</button>
</div>
</section>

<!-- ================= EXERCISES ================= -->
<section id="exercises" class="tab">
<div class="card">
<div class="badge">EXERCISES · CONTEXT</div>
<div id="exQ" class="text-en"></div>
<div id="exOpts"></div>
<button class="btn-main" onclick="loadExercise()">New Exercise</button>
</div>
</section>

<!-- ================= TRANSLATOR ================= -->
<section id="translator" class="tab">
<div class="card">
<div class="badge">TRANSLATOR · PROFESSIONAL</div>

<select id="trDir">
<option value="en-es">English → Español</option>
<option value="es-en">Español → English</option>
</select>

<textarea id="trInput" placeholder="Write your text here..."></textarea>

<button class="btn-main" onclick="doTranslate()">Translate</button>

<div id="trOutput" class="trans-box"></div>
<div id="trMeta" class="trans-meta"></div>

</div>
</section>

<!-- ================= SETTINGS ================= -->
<section id="settings" class="tab">
<div class="card">
<div class="badge">SETTINGS · AI</div>
<label>Gemini API Key</label>
<input id="geminiKey">
<button class="btn-main" onclick="saveKey()">Save Settings</button>
</div>
</section>

</div>

<nav>
<div class="active" onclick="tab('phrases',this)"><i class="fas fa-quote-left"></i>Phrases</div>
<div onclick="tab('speak',this)"><i class="fas fa-microphone"></i>Speak</div>
<div onclick="tab('exercises',this)"><i class="fas fa-list"></i>Exercises</div>
<div onclick="tab('translator',this)"><i class="fas fa-language"></i>Translate</div>
<div onclick="tab('settings',this)"><i class="fas fa-gear"></i>Settings</div>
</nav>

<script>
/* ================= SETTINGS ================= */
geminiKey.value = localStorage.getItem("GEMINI_KEY") || "";
function saveKey(){
localStorage.setItem("GEMINI_KEY", geminiKey.value.trim());
alert("✅ Gemini key saved");
}

/* ================= NAV ================= */
function tab(id,el){
document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
document.getElementById(id).classList.add('active');
document.querySelectorAll('nav div').forEach(n=>n.classList.remove('active'));
el.classList.add('active');
}

/* ================= TTS ================= */
function tts(text,rate){
speechSynthesis.cancel();
const u=new SpeechSynthesisUtterance(text);
u.lang="en-US";u.rate=rate;
speechSynthesis.speak(u);
}

/* ================= PHONETIC ================= */
function englishToSpanishPhonetic(t){
return t.toLowerCase()
.replace(/th/g,"d")
.replace(/ing\b/g,"in")
.replace(/tion\b/g,"shon")
.replace(/ph/g,"f")
.replace(/ee/g,"í")
.replace(/oo/g,"ú");
}

/* ================= GEMINI ================= */
async function gemini(prompt){
const key=localStorage.getItem("GEMINI_KEY");
if(!key) return null;
try{
const r=await fetch(
`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${key}`,
{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})
});
const j=await r.json();
return j.candidates?.[0]?.content?.parts?.[0]?.text || null;
}catch{return null}
}

/* ================= INTERNET ================= */
async function internetSentence(){
try{
const r=await fetch("https://api.quotable.io/random");
return (await r.json()).content;
}catch{return null}
}

/* ================= INTERNAL ================= */
const internalTopics=[
"business","travel","daily life","technology",
"education","work","motivation","social situations"
];
function internalSentence(){
const t=internalTopics[Math.floor(Math.random()*internalTopics.length)];
return `Learning English helps you communicate better in ${t}.`;
}

/* ================= PHRASES ================= */
async function loadPhrase(){
const text =
await gemini("Generate one natural English sentence (B1-B2) about a random real-life topic. No quotes.")
|| await internetSentence()
|| internalSentence();

phEn.innerText=text;
phFig.innerText=englishToSpanishPhonetic(text);
phEs.innerText="";
}

/* ================= SPEAK ================= */
function generateSpeak(){
loadPhrase();
spTarget.innerText=phEn.innerText;
spFig.innerText=phFig.innerText;
spResult.innerHTML="";
spScore.innerHTML="";
}
function startSpeak(){
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(!SR)return;
const r=new SR();
r.lang="en-US";
r.onresult=e=>compareSpeech(e.results[0][0].transcript);
r.start();
}
function compareSpeech(spoken){
const t=spTarget.innerText.toLowerCase().split(" ");
const s=spoken.toLowerCase().split(" ");
let ok=0,h="";
t.forEach((w,i)=>{
if(s[i]===w){ok++;h+=`<span class="word-ok">${w}</span> `}
else h+=`<span class="word-bad">${w}</span> `;
});
spResult.innerHTML=h;
spScore.innerText=`Accuracy: ${Math.round(ok/t.length*100)}%`;
}

/* ================= EXERCISES ================= */
async function loadExercise(){
let s=await internetSentence()||internalSentence();
const w=s.split(" ");
const i=Math.floor(Math.random()*w.length);
const a=w[i];
w[i]="___";
exQ.innerText=w.join(" ");
exOpts.innerHTML="";
[a,"is","are","do","does"].sort(()=>Math.random()-0.5).forEach(o=>{
const d=document.createElement("div");
d.className="option";
d.innerText=o;
d.onclick=()=>d.classList.add(o===a?"correct":"wrong");
exOpts.appendChild(d);
});
}

/* ================= TRANSLATOR ================= */
async function doTranslate(){
const [f,t]=trDir.value.split("-");
trOutput.innerText="Translating...";
trMeta.innerText="";
const start=Date.now();
try{
const r=await fetch(`https://apertium.org/apy/translate?langpair=${f}|${t}&q=${encodeURIComponent(trInput.value)}`);
const j=await r.json();
trOutput.innerText=j.responseData.translatedText;
trMeta.innerText=`Translated in ${Date.now()-start} ms`;
}catch{
trOutput.innerText="Translation unavailable";
}
}

/* INIT */
loadPhrase();
loadExercise();
</script>
<script>
/* =====================================================================
   ELITE ENGLISH PRO · SENTENCE ENGINE v5
   =====================================================================
   OBJETIVO REAL:
   - Frases completamente diferentes (estructura + contenido)
   - Gemini → Internet → IA semántica interna → Gramática profunda
   - Nunca repetir sensación
   - Ultra estable
===================================================================== */

/* =============================
   CONFIGURACIÓN GLOBAL
============================= */
const SENTENCE_ENGINE = {
  levels: ["A2","B1","B2"],
  topics: [
    "travel","work","business","daily life","technology",
    "learning","health","relationships","motivation",
    "culture","food","time","money","habits","education"
  ],
  emergencySentence: "English helps people communicate in real life."
};

/* =============================
   UTILIDADES SEGURAS
============================= */
const pick = a => a[Math.floor(Math.random()*a.length)];

function clean(text){
  return (text||"")
    .replace(/[\r\n]+/g," ")
    .replace(/[^a-zA-Z0-9\s.,!?']/g,"")
    .replace(/\s+/g," ")
    .trim();
}

/* =============================
   PRONUNCIACIÓN FIGURADA AVANZADA
============================= */
function englishToSpanishPhonetic(text){
  if(!text) return "";
  let t = clean(text.toLowerCase());

  const dict = {
    i:"ai", you:"iú", he:"jí", she:"shí", we:"uí", they:"déi",
    the:"da", this:"dis", that:"dat", these:"dís", those:"dóus",
    is:"is", are:"ar", was:"uás", were:"uér",
    have:"jav", has:"jas", had:"jad",
    english:"ínglish", people:"pípol",
    work:"uórk", life:"láif", learning:"lérnin"
  };

  t = t.split(" ").map(w=>dict[w]||w).join(" ");

  [
    [/tion\b/g,"shon"],[/sion\b/g,"shon"],
    [/ough/g,"of"],[/igh/g,"ai"],[/eigh/g,"éi"],
    [/ph/g,"f"],[/ck/g,"k"],[/qu/g,"ku"],[/gh/g,""],
    [/th/g,"d"],[/sh/g,"sh"],[/ch/g,"ch"],
    [/ee/g,"í"],[/ea/g,"í"],[/oo/g,"ú"],
    [/ai/g,"ei"],[/ay/g,"ei"],[/ow/g,"au"],[/ou/g,"au"],
    [/ing\b/g,"in"],[/ed\b/g,"d"],[/ly\b/g,"li"]
  ].forEach(r=>t=t.replace(r[0],r[1]));

  return t;
}

/* =============================
   GEMINI (ORIGINALIDAD TOTAL)
============================= */
async function geminiSentence(){
  const key = localStorage.getItem("GEMINI_KEY");
  if(!key) return null;

  const prompt = `
Write ONE completely original English sentence.
Level: A2-B2
Rules:
- Different structure each time
- Real-life situation, thought, advice, question or opinion
- No quotes
- Natural human English
`;

  try{
    const c = new AbortController();
    setTimeout(()=>c.abort(),7000);

    const r = await fetch(
      "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key="+key,
      {
        method:"POST",
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({contents:[{parts:[{text:prompt}]}]}),
        signal:c.signal
      }
    );
    const j = await r.json();
    return clean(j?.candidates?.[0]?.content?.parts?.[0]?.text);
  }catch{
    return null;
  }
}

/* =============================
   INTERNET (FRASES REALES)
============================= */
async function internetSentence(){
  const sources = [
    async()=> (await (await fetch("https://api.quotable.io/random")).json()).content,
    async()=> (await (await fetch("https://api.adviceslip.com/advice")).json()).slip.advice
  ];

  for(const s of sources){
    try{
      const t = clean(await s());
      if(t && t.split(" ").length > 5) return t;
    }catch{}
  }
  return null;
}

/* =============================
   MOTOR SEMÁNTICO (NO PLANTILLAS)
============================= */
function semanticSentence(){
  const patterns = [

    () => `Have you ever noticed how ${pick(["confidence","communication","practice"])} changes when you use English every day?`,

    () => `When people travel abroad, they often realize that English is more useful than they expected.`,

    () => `Many professionals feel nervous at first, but speaking English becomes easier with time.`,

    () => `If you want to grow professionally, improving your English can make a real difference.`,

    () => `Some conversations are difficult, yet English helps connect people from different cultures.`,

    () => `Using English at work is not always easy, especially when discussions become complex.`,

    () => `Over time, learners discover that understanding English is more about practice than talent.`
  ];

  return pick(patterns)();
}

/* =============================
   MOTOR GRAMATICAL PROFUNDO
============================= */
function grammarSentence(){
  const forms = [

    () => `English is often used when important decisions need to be discussed clearly.`,

    () => `Why do so many people choose English as their main communication language?`,

    () => `Being able to express ideas in English can change the way others see you.`,

    () => `It takes patience and consistency to feel comfortable speaking English.`,

    () => `Not everyone learns English at the same pace, and that is completely normal.`
  ];

  return pick(forms)();
}

/* =============================
   GENERADOR MAESTRO (INFALIBLE)
============================= */
async function generateSentence(){
  return (
    await geminiSentence() ||
    await internetSentence() ||
    semanticSentence() ||
    grammarSentence() ||
    SENTENCE_ENGINE.emergencySentence
  );
}

/* =============================
   API FINAL PARA LA APP
============================= */
async function getPhrase(){
  const text = await generateSentence();
  return {
    text,
    phonetic: englishToSpanishPhonetic(text)
  };
}

async function getSpeak(){
  const text = await generateSentence();
  return {
    text,
    phonetic: englishToSpanishPhonetic(text),
    clean: clean(text.toLowerCase())
  };
}

async function getExercise(){
  const text = await generateSentence();
  const words = text.split(" ");
  const i = Math.floor(Math.random()*words.length);
  const answer = words[i];
  words[i] = "___";

  const options = [answer,"is","are","do","does","have","can"]
    .sort(()=>Math.random()-0.5)
    .slice(0,4);

  return {
    question: words.join(" "),
    answer,
    options
  };
}

console.log("✅ Sentence Engine v5 loaded · FULL variation enabled");
</script>
</body>
</html>
