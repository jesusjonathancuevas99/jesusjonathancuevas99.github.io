<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Elite English Pro · Ultimate Stable</title>

<!-- ICONOS Y FUENTES -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Outfit:wght@700;900&display=swap" rel="stylesheet">

<style>
/* =========================================================
   VARIABLES GLOBALES
========================================================= */
:root{
--bg:#050812;
--card:#12183a;
--card2:#0b0f2e;
--text:#f4f6ff;
--muted:#aab3d9;
--brand:#7b7cff;
--brand2:#35e3ff;
--gold:#ffd479;
--ok:#2bff88;
--bad:#ff5a5a;
}

/* =========================================================
   RESET Y BASE
========================================================= */
*{box-sizing:border-box}
body{
margin:0;
font-family:Inter,system-ui;
background:radial-gradient(1200px 700px at 50% -300px,#1c2570,#050812);
color:var(--text);
padding-bottom:120px;
}

/* =========================================================
   HEADER
========================================================= */
header{
padding:18px;
font-family:Outfit;
font-weight:900;
text-align:center;
background:#050812dd;
backdrop-filter:blur(24px);
position:sticky;
top:0;
z-index:50;
}

/* =========================================================
   LAYOUT
========================================================= */
.container{
max-width:900px;
margin:auto;
padding:24px;
}

.card{
background:linear-gradient(180deg,var(--card),var(--card2));
border-radius:28px;
padding:26px;
margin-bottom:28px;
box-shadow:0 40px 120px rgba(0,0,0,.65);
}

.badge{
font-size:.7rem;
font-weight:900;
letter-spacing:.12em;
color:#bcd1ff;
margin-bottom:12px;
}

/* =========================================================
   TEXTOS
========================================================= */
.text-en{
font-family:Outfit;
font-size:1.6rem;
line-height:1.35;
}
.text-es{
color:var(--muted);
margin-top:10px;
}
.text-fig{
font-family:monospace;
color:var(--gold);
background:#0008;
padding:14px;
border-radius:14px;
margin-top:12px;
}

/* =========================================================
   BOTONES
========================================================= */
.controls{
display:flex;
gap:12px;
margin-top:14px;
flex-wrap:wrap;
}
.btn-icon{
width:48px;
height:48px;
border-radius:50%;
border:none;
background:linear-gradient(135deg,var(--brand),var(--brand2));
color:#fff;
font-size:1.1rem;
cursor:pointer;
}
.btn-main{
width:100%;
padding:16px;
border:none;
border-radius:22px;
background:linear-gradient(135deg,var(--brand),var(--brand2));
font-family:Outfit;
font-weight:900;
color:#fff;
margin-top:18px;
cursor:pointer;
}

/* =========================================================
   TABS
========================================================= */
.tab{display:none}
.tab.active{display:block}

/* =========================================================
   NAV BAR
========================================================= */
nav{
position:fixed;
bottom:0;
left:0;
right:0;
height:88px;
background:#050812f2;
backdrop-filter:blur(30px);
display:flex;
justify-content:space-around;
align-items:center;
z-index:100;
}
nav div{
display:flex;
flex-direction:column;
align-items:center;
gap:6px;
font-size:.65rem;
font-weight:900;
color:#9aa3d0;
transition:.25s;
cursor:pointer;
}
nav i{font-size:1.5rem}
nav .active{
color:var(--brand2);
transform:translateY(-6px);
}

/* =========================================================
   SPEAK
========================================================= */
.word-ok{color:var(--ok);font-weight:700}
.word-bad{color:var(--bad);font-weight:700}

/* =========================================================
   EXERCISES
========================================================= */
.option{
background:#0006;
border-radius:16px;
padding:14px;
margin-top:10px;
cursor:pointer;
transition:.2s;
}
.option:hover{transform:scale(1.02)}
.correct{background:#0f03;color:var(--ok)}
.wrong{background:#3003;color:var(--bad)}
</style>
</head>

<body>

<header>ELITE ENGLISH PRO · ULTIMATE</header>

<div class="container">

<!-- ===================================================== -->
<!-- PHRASES -->
<!-- ===================================================== -->
<section id="phrases" class="tab active">
<div class="card">
<div class="badge">PHRASES</div>
<div id="phEn" class="text-en"></div>
<div id="phFig" class="text-fig"></div>
<div id="phEs" class="text-es"></div>
<div class="controls">
<button class="btn-icon" onclick="tts(phEn.innerText,'en',1)"><i class="fas fa-play"></i></button>
<button class="btn-icon" onclick="tts(phEn.innerText,'en',0.6)"><i class="fas fa-snail"></i></button>
<button class="btn-icon" onclick="duo(phEn.innerText,phEs.innerText)"><i class="fas fa-globe"></i></button>
</div>
<button class="btn-main" onclick="loadPhrase()">NEW PHRASE</button>
</div>
</section>

<!-- ===================================================== -->
<!-- STORIES -->
<!-- ===================================================== -->
<section id="stories" class="tab">
<div class="card">
<div class="badge">STORIES</div>
<div id="stEn" class="text-en"></div>
<div id="stFig" class="text-fig"></div>
<div id="stEs" class="text-es"></div>
<div class="controls">
<button class="btn-icon" onclick="tts(stEn.innerText,'en',1)"><i class="fas fa-play"></i></button>
<button class="btn-icon" onclick="tts(stEn.innerText,'en',0.6)"><i class="fas fa-snail"></i></button>
<button class="btn-icon" onclick="duo(stEn.innerText,stEs.innerText)"><i class="fas fa-globe"></i></button>
</div>
<button class="btn-main" onclick="loadStory()">NEW STORY</button>
</div>
</section>

<!-- ===================================================== -->
<!-- SPEAK -->
<!-- ===================================================== -->
<section id="speak" class="tab">
<div class="card">
<div class="badge">SPEAK</div>
<div id="spTarget" class="text-en"></div>
<div id="spFig" class="text-fig"></div>
<div id="spEs" class="text-es"></div>
<div class="controls">
<button class="btn-icon" onclick="tts(spTarget.innerText,'en',1)"><i class="fas fa-play"></i></button>
<button class="btn-icon" onclick="startSpeak()"><i class="fas fa-microphone"></i></button>
</div>
<div id="spResult"></div>
<div id="spScore"></div>
<button class="btn-main" onclick="generateSpeak()">NEW PHRASE</button>
</div>
</section>

<!-- ===================================================== -->
<!-- EXERCISES -->
<!-- ===================================================== -->
<section id="exercises" class="tab">
<div class="card">
<div class="badge">EXERCISES</div>
<div id="exQ" class="text-en"></div>
<div id="exOpts"></div>
<button class="btn-main" onclick="loadExercise()">NEW EXERCISE</button>
</div>
</section>

</div>

<!-- ===================================================== -->
<!-- NAV -->
<!-- ===================================================== -->
<nav>
<div class="active" onclick="tab('phrases',this)"><i class="fas fa-bolt"></i><span>PHRASES</span></div>
<div onclick="tab('stories',this)"><i class="fas fa-book"></i><span>STORIES</span></div>
<div onclick="tab('speak',this)"><i class="fas fa-microphone"></i><span>SPEAK</span></div>
<div onclick="tab('exercises',this)"><i class="fas fa-dumbbell"></i><span>EXERCISES</span></div>
</nav>

<script>
/* =========================================================
   AUDIO
========================================================= */
function tts(text,lang,rate){
if(!text) return;
speechSynthesis.cancel();
const u=new SpeechSynthesisUtterance(text);
u.lang=lang==="en"?"en-US":"es-ES";
u.rate=rate;
speechSynthesis.speak(u);
}
function duo(en,es){
tts(en,"en",1);
setTimeout(()=>{ if(es) tts(es,"es",1); },1200);
}

/* =========================================================
   PRONUNCIACIÓN FIGURADA
========================================================= */
function pronunciacionFiguradaEN(t){
return t.toLowerCase()
.replace(/th/g,"d")
.replace(/ph/g,"f")
.replace(/tion\b/g,"shon")
.replace(/ing\b/g,"in");
}

/* =========================================================
   FETCH DEFENSIVO
========================================================= */
async function fetchSafe(url,opt={},timeout=12000){
const ctrl=new AbortController();
setTimeout(()=>ctrl.abort(),timeout);
try{
return await fetch(url,{...opt,signal:ctrl.signal});
}catch{
return null;
}
}

/* =========================================================
   TRADUCTORES
========================================================= */
async function viaApertium(text,f,t,base){
const r=await fetchSafe(`${base}/translate?langpair=${f}|${t}&q=${encodeURIComponent(text)}`);
if(!r) return null;
try{
const j=await r.json();
return j?.responseData?.translatedText||null;
}catch{return null;}
}
async function viaLibre(text,f,t){
const r=await fetchSafe("https://libretranslate.com/translate",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({q:text,source:f,target:t,format:"text"})
});
if(!r) return null;
try{
const j=await r.json();
return typeof j.translatedText==="string"?j.translatedText:null;
}catch{return null;}
}
async function viaArgos(text,f,t){
const r=await fetchSafe("https://translate.argosopentech.com/translate",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({q:text,source:f,target:t,format:"text"})
});
if(!r) return null;
try{
const j=await r.json();
return j.translatedText||null;
}catch{return null;}
}
async function viaLocal(text,f,t){
for(const b of ["http://localhost:5000","http://127.0.0.1:5000"]){
const r=await fetchSafe(`${b}/translate`,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({q:text,source:f,target:t,format:"text"})
});
if(!r) continue;
try{
const j=await r.json();
if(j.translatedText) return j.translatedText;
}catch{}
}
return null;
}

/* =========================================================
   TRADUCCIÓN FINAL (NUNCA FALLA)
========================================================= */
async function translateSmart(text,f,t){
return (
await viaApertium(text,f,t,"https://apertium.org/apy") ||
await viaApertium(text,f,t,"https://beta.apertium.org/apy") ||
await viaLibre(text,f,t) ||
await viaArgos(text,f,t) ||
await viaLocal(text,f,t) ||
"⚠️ Traducción no disponible"
);
}

/* =========================================================
   CONTENIDO
========================================================= */
async function loadPhrase(){
const r=await fetchSafe("https://api.adviceslip.com/advice");
let text="Practice makes progress.";
try{
const j=await r.json();
text=j.slip.advice;
}catch{}
phEn.innerText=text;
phFig.innerText=pronunciacionFiguradaEN(text);
phEs.innerText=await translateSmart(text,"en","es");
}

async function loadStory(){
const r=await fetchSafe("https://en.wikipedia.org/api/rest_v1/page/random/summary");
let text="Learning languages opens new worlds.";
try{
const j=await r.json();
text=j.extract;
}catch{}
stEn.innerText=text;
stFig.innerText=pronunciacionFiguradaEN(text);
stEs.innerText=await translateSmart(text,"en","es");
}

async function generateSpeak(){
await loadPhrase();
spTarget.innerText=phEn.innerText;
spFig.innerText=phFig.innerText;
spEs.innerText=phEs.innerText;
}

function loadExercise(){
exQ.innerText="She ___ English every day.";
exOpts.innerHTML="";
["study","studies","studying"].forEach((o,i)=>{
const d=document.createElement("div");
d.className="option";
d.innerText=o;
d.onclick=()=>d.classList.add(i===1?"correct":"wrong");
exOpts.appendChild(d);
});
}

/* =========================================================
   SPEAK
========================================================= */
function startSpeak(){
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(!SR){alert("Speech Recognition no soportado");return;}
const r=new SR();
r.lang="en-US";
r.onresult=e=>{
compareSpeech(e.results[0][0].transcript,spTarget.innerText);
};
r.start();
}
function compareSpeech(spoken,target){
const s=spoken.toLowerCase().split(" ");
const t=target.toLowerCase().split(" ");
let ok=0,res="";
t.forEach(w=>{
if(s.includes(w)){ok++;res+=`<span class="word-ok">${w}</span> `;}
else res+=`<span class="word-bad">${w}</span> `;
});
spResult.innerHTML=res;
spScore.innerHTML=`✅ Pronunciation: ${Math.round(ok/t.length*100)}%`;
}

/* =========================================================
   NAV
========================================================= */
function tab(id,el){
document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
document.getElementById(id).classList.add('active');
document.querySelectorAll('nav div').forEach(n=>n.classList.remove('active'));
el.classList.add('active');
}

/* =========================================================
   INIT
========================================================= */
loadPhrase();
loadStory();
loadExercise();
</script>

</body>
</html>
