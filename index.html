<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Elite English Pro · Professional Edition</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Source+Serif+4:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
:root{
--bg:#f5f7fb;
--card:#ffffff;
--accent:#2563eb;
--accent-soft:#e8f0ff;
--text:#0f172a;
--muted:#64748b;
--ok:#16a34a;
--bad:#dc2626;
--border:#e2e8f0;
}
*{box-sizing:border-box}
body{
margin:0;
font-family:Inter;
background:linear-gradient(180deg,#f8fafc,#eef2ff);
color:var(--text);
padding-bottom:110px;
}
header{
font-family:Source Serif 4;
font-size:1.9rem;
padding:26px;
text-align:center;
background:white;
border-bottom:1px solid var(--border);
position:sticky;top:0;z-index:100;
}
.container{max-width:1180px;margin:auto;padding:30px}

/* CARDS */
.card{
background:var(--card);
border-radius:18px;
padding:32px;
margin-bottom:34px;
border:1px solid var(--border);
}
.badge{
font-size:.7rem;
font-weight:800;
letter-spacing:.18em;
color:var(--accent);
margin-bottom:16px;
}
.text-en{
font-size:2.05rem;
font-weight:700;
line-height:1.4;
}
.text-fig{
background:var(--accent-soft);
padding:16px;
border-radius:12px;
margin-top:14px;
font-family:monospace;
}
.text-es{
color:var(--muted);
margin-top:10px;
}

/* BUTTONS */
.controls{
display:flex;
gap:14px;
margin-top:20px;
flex-wrap:wrap;
}
.btn-icon{
width:52px;height:52px;border-radius:50%;
border:1px solid var(--border);
background:white;
color:var(--accent);
font-size:1.2rem;
cursor:pointer;
}
.btn-main{
width:100%;
margin-top:24px;
padding:18px;
border-radius:14px;
border:none;
background:var(--accent);
color:white;
font-weight:800;
cursor:pointer;
}

/* SPEAK */
.word-ok{color:var(--ok);font-weight:700}
.word-bad{color:var(--bad);font-weight:700}

/* EXERCISES */
.option{
padding:16px;
border-radius:12px;
background:#fff;
margin-top:12px;
cursor:pointer;
border:1px solid var(--border);
}
.correct{background:#ecfdf5;color:var(--ok)}
.wrong{background:#fef2f2;color:var(--bad)}

input,textarea,select{
width:100%;
padding:14px;
border-radius:10px;
border:1px solid var(--border);
background:white;
margin-top:10px;
font-family:Inter;
}
textarea{min-height:140px}

.tab{display:none}
.tab.active{display:block}

/* NAV */
nav{
position:fixed;
bottom:0;left:0;right:0;
height:88px;
background:white;
border-top:1px solid var(--border);
display:flex;
justify-content:space-around;
align-items:center;
}
nav div{
font-size:.65rem;
font-weight:800;
color:var(--muted);
cursor:pointer;
display:flex;
flex-direction:column;
align-items:center;
gap:6px;
}
nav i{font-size:1.5rem}
nav .active{color:var(--accent)}
</style>
</head>

<body>

<header>Elite English Pro</header>

<div class="container">

<!-- PHRASES -->
<section id="phrases" class="tab active">
<div class="card">
<div class="badge">PHRASES</div>
<div id="phEn" class="text-en"></div>
<div id="phFig" class="text-fig"></div>
<div id="phEs" class="text-es"></div>
<div class="controls">
<button class="btn-icon" onclick="tts(phEn.innerText,1)"><i class="fas fa-play"></i></button>
<button class="btn-icon" onclick="tts(phEn.innerText,0.6)"><i class="fas fa-snail"></i></button>
</div>
<button class="btn-main" onclick="loadPhrase()">NEW PHRASE</button>
</div>
</section>

<!-- SPEAK -->
<section id="speak" class="tab">
<div class="card">
<div class="badge">SPEAK</div>
<div id="spTarget" class="text-en"></div>
<div id="spFig" class="text-fig"></div>
<div id="spResult"></div>
<div id="spScore" style="margin-top:14px;font-weight:700"></div>
<div class="controls">
<button class="btn-icon" onclick="tts(spTarget.innerText,1)"><i class="fas fa-play"></i></button>
<button class="btn-icon" onclick="startSpeak()"><i class="fas fa-microphone"></i></button>
</div>
<button class="btn-main" onclick="generateSpeak()">NEW SPEAK</button>
</div>
</section>

<!-- EXERCISES -->
<section id="exercises" class="tab">
<div class="card">
<div class="badge">EXERCISES</div>
<div id="exQ" class="text-en"></div>
<div id="exOpts"></div>
<button class="btn-main" onclick="loadExercise()">NEW EXERCISE</button>
</div>
</section>

<!-- TRANSLATOR -->
<section id="translator" class="tab">
<div class="card">
<div class="badge">TRANSLATOR</div>
<select id="trDir">
<option value="en-es">English → Español</option>
<option value="es-en">Español → English</option>
</select>
<textarea id="trInput" placeholder="Enter text"></textarea>
<button class="btn-main" onclick="doTranslate()">TRANSLATE</button>
<div id="trOutput" class="text-es"></div>
</div>
</section>

<!-- GLOBAL -->
<section id="global" class="tab">
<div class="card">
<div class="badge">GLOBAL SETTINGS</div>
<label>Gemini API Key</label>
<input id="geminiKey">
<button class="btn-main" onclick="saveGlobal()">SAVE SETTINGS</button>
</div>
</section>

</div>

<nav>
<div class="active" onclick="tab('phrases',this)"><i class="fas fa-quote-left"></i>PHRASES</div>
<div onclick="tab('speak',this)"><i class="fas fa-microphone"></i>SPEAK</div>
<div onclick="tab('exercises',this)"><i class="fas fa-list"></i>EXERCISES</div>
<div onclick="tab('translator',this)"><i class="fas fa-language"></i>TRANSLATOR</div>
<div onclick="tab('global',this)"><i class="fas fa-gear"></i>GLOBAL</div>
</nav>

<script>
/* ================= GLOBAL ================= */
let TRANSLATION_ENABLED=true;
geminiKey.value=localStorage.getItem("GEMINI_KEY")||"";
function saveGlobal(){
localStorage.setItem("GEMINI_KEY",geminiKey.value.trim());
alert("✅ Settings saved");
}

/* ================= UTIL ================= */
function tts(t,r){
speechSynthesis.cancel();
const u=new SpeechSynthesisUtterance(t);
u.lang="en-US";u.rate=r;
speechSynthesis.speak(u);
}
function tab(id,el){
document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
document.getElementById(id).classList.add('active');
document.querySelectorAll('nav div').forEach(n=>n.classList.remove('active'));
el.classList.add('active');
}
function clean(s){return s.toLowerCase().replace(/[^a-z\s]/g,"").trim()}

/* ================= PHONETIC ================= */
function englishToSpanishPhonetic(t){
return t.toLowerCase()
.replace(/th/g,"d")
.replace(/ing\b/g,"in")
.replace(/tion\b/g,"shon");
}

/* ================= TRANSLATOR (FALLBACK) ================= */
async function translateSmart(text,from,to){
if(!TRANSLATION_ENABLED) return "Translation disabled";
return (
await viaApertium(text,from,to,"https://apertium.org/apy") ||
await viaApertium(text,from,to,"https://beta.apertium.org/apy") ||
await viaLibre(text,from,to) ||
await viaArgos(text,from,to) ||
"⚠️ Translation unavailable"
);
}
async function viaApertium(t,f,to,b){
try{
const r=await fetch(`${b}/translate?langpair=${f}|${to}&q=${encodeURIComponent(t)}`);
return (await r.json()).responseData.translatedText;
}catch{return null}
}
async function viaLibre(t,f,to){
try{
const r=await fetch("https://libretranslate.com/translate",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({q:t,source:f,target:to})});
return (await r.json()).translatedText;
}catch{return null}
}
async function viaArgos(t,f,to){
try{
const r=await fetch("https://translate.argosopentech.com/translate",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({q:t,source:f,target:to})});
return (await r.json()).translatedText;
}catch{return null}
}

/* ================= PHRASES ================= */
const subjects=["I","You","We","They","Learning English","Daily practice"];
const verbs=["improves","changes","builds","creates","strengthens"];
const complements=["your confidence","your future","your skills","new opportunities"];

async function loadPhrase(){
let t;
try{t=(await (await fetch("https://api.quotable.io/random")).json()).content}catch{}
if(!t){
const s=subjects[Math.floor(Math.random()*subjects.length)];
const v=verbs[Math.floor(Math.random()*verbs.length)];
const c=complements[Math.floor(Math.random()*complements.length)];
t=`${s} ${v} ${c}.`;
}
phEn.innerText=t;
phFig.innerText=englishToSpanishPhonetic(t);
phEs.innerText=await translateSmart(t,"en","es");
}

/* ================= SPEAK ================= */
function startSpeak(){
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
const r=new SR();r.lang="en-US";
r.onresult=e=>compareSpeech(e.results[0][0].transcript);
r.start();
}
function compareSpeech(spoken){
const t=clean(spTarget.innerText).split(" ");
const s=clean(spoken).split(" ");
let ok=0,html="";
t.forEach((w,i)=>{
if(s[i]===w){ok++;html+=`<span class="word-ok">${w}</span> `;}
else html+=`<span class="word-bad">${w}</span> `;
});
spResult.innerHTML=html;
spScore.innerText=`Accuracy: ${Math.round(ok/t.length*100)}%`;
}
function generateSpeak(){
loadPhrase();
spTarget.innerText=phEn.innerText;
spFig.innerText=phFig.innerText;
spResult.innerHTML="";spScore.innerHTML="";
}

/* ================= EXERCISES ================= */
async function loadExercise(){
let s;
try{s=(await (await fetch("https://api.adviceslip.com/advice")).json()).slip.advice}catch{}
if(!s)s=phEn.innerText||"Learning English improves your confidence";
const w=s.split(" ");
const i=Math.floor(Math.random()*w.length);
const a=w[i];
w[i]="___";
exQ.innerText=w.join(" ");
exOpts.innerHTML="";
[a,"is","are","do","does"].sort(()=>Math.random()-0.5).forEach(o=>{
const d=document.createElement("div");
d.className="option";
d.innerText=o;
d.onclick=()=>d.classList.add(o===a?"correct":"wrong");
exOpts.appendChild(d);
});
}

/* INIT */
loadPhrase();
loadExercise();
</script>
<script>
/* ============================================================
   ENGLISH → SPANISH PHONETIC PRONUNCIATION (PRO)
   ------------------------------------------------------------
   ✅ Educativo
   ✅ Sin APIs
   ✅ Sin dependencias
   ✅ Pensado para hispanohablantes
   ✅ Pronunciación figurada clara (NO IPA)
   ------------------------------------------------------------
   USO:
   englishToSpanishPhonetic("Learning English is very important");
   → "lérnin ínglish is véri importan"
============================================================ */

/**
 * FUNCIÓN PRINCIPAL
 * @param {string} text - Texto en inglés
 * @returns {string} - Pronunciación figurada en español
 */
function englishToSpanishPhonetic(text) {

  /* ================= VALIDACIÓN ================= */
  if (!text || typeof text !== "string") return "";

  /* ================= NORMALIZACIÓN ================= */
  let t = text
    .toLowerCase()
    .replace(/’/g, "'")
    .replace(/[^a-z0-9\s'.?,!]/g, "")
    .trim();

  /* ================= DICCIONARIO BASE =================
     Palabras comunes que deben sonar NATURALES en español
  ===================================================== */
  const dictionary = {
    "i": "ai",
    "you": "iú",
    "he": "jí",
    "she": "shí",
    "we": "uí",
    "they": "déi",

    "the": "da",
    "this": "dis",
    "that": "dat",
    "these": "dís",
    "those": "dóus",

    "is": "is",
    "are": "ar",
    "was": "uás",
    "were": "uér",

    "have": "jav",
    "has": "jas",
    "had": "jad",

    "do": "dú",
    "does": "das",
    "did": "did",

    "a": "a",
    "an": "an",
    "to": "tú",
    "of": "ov",
    "for": "for",
    "with": "uid",

    "and": "and",
    "or": "or",
    "but": "bat",
    "not": "nat",

    "yes": "yés",
    "no": "nó"
  };

  /* ================= APLICAR DICCIONARIO ================= */
  t = t
    .split(/\s+/)
    .map(word => dictionary[word] || word)
    .join(" ");

  /* ================= SONIDOS COMPLEJOS =================
     Grupos de letras con sonido específico en inglés
  ===================================================== */
  t = t
    .replace(/tion\b/g, "shon")
    .replace(/sion\b/g, "shon")
    .replace(/cial/g, "shal")
    .replace(/tial/g, "shal")

    .replace(/ough/g, "of")
    .replace(/augh/g, "af")
    .replace(/igh/g, "ai")
    .replace(/eigh/g, "éi")

    .replace(/ph/g, "f")
    .replace(/gh/g, "")
    .replace(/ck/g, "k")
    .replace(/qu/g, "ku");

  /* ================= CONSONANTES ================= */
  t = t
    .replace(/th/g, "d")
    .replace(/sh/g, "sh")
    .replace(/ch/g, "ch")
    .replace(/j/g, "y")
    .replace(/v/g, "v")
    .replace(/z/g, "s")
    .replace(/x/g, "ks")
    .replace(/r/g, "r");

  /* ================= VOCALES ================= */
  t = t
    .replace(/ee/g, "í")
    .replace(/oo/g, "ú")
    .replace(/ea/g, "í")
    .replace(/ai/g, "ei")
    .replace(/ay/g, "ei")
    .replace(/oa/g, "ou")
    .replace(/ou/g, "au")
    .replace(/ow/g, "au")
    .replace(/ie/g, "ai")
    .replace(/i\b/g, "ai")
    .replace(/u\b/g, "iu");

  /* ================= TERMINACIONES ================= */
  t = t
    .replace(/ing\b/g, "in")
    .replace(/ed\b/g, "d")
    .replace(/er\b/g, "er")
    .replace(/ly\b/g, "li");

  /* ================= LIMPIEZA FINAL ================= */
  t = t
    .replace(/\s+/g, " ")
    .replace(/\s([.,!?])/g, "$1")
    .trim();

  return t;
}

/* ============================================================
   EJEMPLOS:
   ------------------------------------------------------------
   englishToSpanishPhonetic("I think this is easy");
   → "ai dínk dis is ísi"

   englishToSpanishPhonetic("She speaks English very well");
   → "shí spíks ínglish véri uél"

   englishToSpanishPhonetic("Learning English changes your life");
   → "lérnin ínglish chéinyis yór láif"
============================================================ */
</script>
</body>
</html>
