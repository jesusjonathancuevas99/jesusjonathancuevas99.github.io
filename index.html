<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Elite English Pro</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
/* ================= MOBILE PREMIUM THEME ================= */
:root{
--bg:#f8fafc;
--card:#ffffff;
--accent:#2563eb;
--accent-soft:#eff6ff;
--text:#020617;
--muted:#64748b;
--border:#e5e7eb;
--ok:#16a34a;
--bad:#dc2626;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{
margin:0;
font-family:Inter;
background:var(--bg);
color:var(--text);
padding-bottom:92px;
}

/* ================= HEADER ================= */
header{
height:64px;
display:flex;
align-items:center;
justify-content:center;
font-weight:800;
font-size:1.2rem;
background:white;
border-bottom:1px solid var(--border);
position:sticky;
top:0;
z-index:10;
}

/* ================= CONTENT ================= */
.container{
padding:20px;
}

/* ================= CARDS ================= */
.card{
background:var(--card);
border-radius:22px;
padding:24px;
margin-bottom:22px;
box-shadow:0 10px 25px rgba(0,0,0,.06);
}
.badge{
font-size:.65rem;
font-weight:800;
letter-spacing:.18em;
color:var(--accent);
margin-bottom:14px;
}
.text-en{
font-size:1.8rem;
font-weight:700;
line-height:1.35;
}
.text-fig{
background:var(--accent-soft);
padding:14px;
border-radius:14px;
margin-top:14px;
font-family:monospace;
}
.text-es{
margin-top:10px;
color:var(--muted);
}

/* ================= CONTROLS ================= */
.controls{
display:flex;
gap:14px;
margin-top:18px;
}
.btn-icon{
width:50px;height:50px;
border-radius:50%;
border:none;
background:var(--accent);
color:white;
font-size:1.1rem;
display:flex;
align-items:center;
justify-content:center;
}
.btn-main{
margin-top:22px;
width:100%;
padding:16px;
border-radius:18px;
border:none;
background:var(--accent);
color:white;
font-weight:800;
font-size:1rem;
}

/* ================= SPEAK ================= */
.word-ok{color:var(--ok);font-weight:700}
.word-bad{color:var(--bad);font-weight:700}

/* ================= EXERCISES ================= */
.option{
padding:16px;
border-radius:16px;
background:white;
border:1px solid var(--border);
margin-top:12px;
}
.correct{background:#ecfdf5;color:var(--ok)}
.wrong{background:#fef2f2;color:var(--bad)}

input,textarea,select{
width:100%;
padding:14px;
border-radius:14px;
border:1px solid var(--border);
margin-top:12px;
font-family:Inter;
}

/* ================= TABS ================= */
.tab{display:none}
.tab.active{display:block}

/* ================= BOTTOM NAV ================= */
nav{
position:fixed;
bottom:0;left:0;right:0;
height:82px;
background:white;
border-top:1px solid var(--border);
display:flex;
justify-content:space-around;
align-items:center;
}
nav div{
display:flex;
flex-direction:column;
align-items:center;
gap:6px;
font-size:.65rem;
font-weight:700;
color:var(--muted);
}
nav .active{color:var(--accent)}
nav i{font-size:1.6rem}
</style>
</head>

<body>

<header>Elite English Pro</header>

<div class="container">

<!-- PHRASES -->
<section id="phrases" class="tab active">
<div class="card">
<div class="badge">PHRASE</div>
<div id="phEn" class="text-en"></div>
<div id="phFig" class="text-fig"></div>
<div id="phEs" class="text-es"></div>
<div class="controls">
<button class="btn-icon" onclick="tts(phEn.innerText,1)"><i class="fas fa-play"></i></button>
<button class="btn-icon" onclick="tts(phEn.innerText,.6)"><i class="fas fa-snail"></i></button>
</div>
<button class="btn-main" onclick="loadPhrase()">New Phrase</button>
</div>
</section>

<!-- SPEAK -->
<section id="speak" class="tab">
<div class="card">
<div class="badge">SPEAK</div>
<div id="spTarget" class="text-en"></div>
<div id="spFig" class="text-fig"></div>
<div id="spResult"></div>
<div id="spScore" style="margin-top:12px;font-weight:700"></div>
<div class="controls">
<button class="btn-icon" onclick="tts(spTarget.innerText,1)"><i class="fas fa-play"></i></button>
<button class="btn-icon" onclick="startSpeak()"><i class="fas fa-microphone"></i></button>
</div>
<button class="btn-main" onclick="generateSpeak()">New Speak</button>
</div>
</section>

<!-- EXERCISES -->
<section id="exercises" class="tab">
<div class="card">
<div class="badge">EXERCISE</div>
<div id="exQ" class="text-en"></div>
<div id="exOpts"></div>
<button class="btn-main" onclick="loadExercise()">New Exercise</button>
</div>
</section>

<!-- TRANSLATOR -->
<section id="translator" class="tab">
<div class="card">
<div class="badge">TRANSLATOR</div>
<select id="trDir">
<option value="en-es">English → Español</option>
<option value="es-en">Español → English</option>
</select>
<textarea id="trInput" placeholder="Enter text"></textarea>
<button class="btn-main" onclick="doTranslate()">Translate</button>
<div id="trOutput" class="text-es"></div>
</div>
</section>

<!-- SETTINGS -->
<section id="global" class="tab">
<div class="card">
<div class="badge">SETTINGS</div>
<label>Gemini API Key</label>
<input id="geminiKey">
<button class="btn-main" onclick="saveGlobal()">Save</button>
</div>
</section>

</div>

<nav>
<div class="active" onclick="tab('phrases',this)"><i class="fas fa-quote-left"></i>Phrases</div>
<div onclick="tab('speak',this)"><i class="fas fa-microphone"></i>Speak</div>
<div onclick="tab('exercises',this)"><i class="fas fa-list"></i>Exercises</div>
<div onclick="tab('translator',this)"><i class="fas fa-language"></i>Translate</div>
<div onclick="tab('global',this)"><i class="fas fa-gear"></i>Settings</div>
</nav>

<script>
/* ================= NAV ================= */
function tab(id,el){
document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
document.getElementById(id).classList.add('active');
document.querySelectorAll('nav div').forEach(n=>n.classList.remove('active'));
el.classList.add('active');
}

/* ================= GLOBAL ================= */
geminiKey.value=localStorage.getItem("GEMINI_KEY")||"";
function saveGlobal(){
localStorage.setItem("GEMINI_KEY",geminiKey.value.trim());
alert("✅ Saved");
}

/* ================= TTS ================= */
function tts(text,rate){
speechSynthesis.cancel();
const u=new SpeechSynthesisUtterance(text);
u.lang="en-US";
u.rate=rate;
speechSynthesis.speak(u);
}

/* ================= PHONETIC ================= */
function englishToSpanishPhonetic(text){
return text.toLowerCase()
.replace(/th/g,"d")
.replace(/ing\b/g,"in")
.replace(/tion\b/g,"shon")
.replace(/ph/g,"f");
}

/* ================= TRANSLATOR ================= */
async function doTranslate(){
const [f,t]=trDir.value.split("-");
trOutput.innerText="Translating...";
trOutput.innerText=await translateSmart(trInput.value,f,t);
}
async function translateSmart(text,from,to){
try{
const r=await fetch(`https://apertium.org/apy/translate?langpair=${from}|${to}&q=${encodeURIComponent(text)}`);
return (await r.json()).responseData.translatedText;
}catch{
return "Translation unavailable";
}
}

/* ================= PHRASES ================= */
const subjects=["I","You","We","They","Learning English","Daily practice"];
const verbs=["improves","builds","creates","strengthens"];
const complements=["your confidence","your future","your skills","new opportunities"];

async function loadPhrase(){
let t;
try{t=(await (await fetch("https://api.quotable.io/random")).json()).content}catch{}
if(!t){
t=`${subjects[Math.floor(Math.random()*subjects.length)]} ${verbs[Math.floor(Math.random()*verbs.length)]} ${complements[Math.floor(Math.random()*complements.length)]}.`;
}
phEn.innerText=t;
phFig.innerText=englishToSpanishPhonetic(t);
phEs.innerText=await translateSmart(t,"en","es");
}

/* ================= SPEAK ================= */
function startSpeak(){
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(!SR)return;
const r=new SR();
r.lang="en-US";
r.onresult=e=>compareSpeech(e.results[0][0].transcript);
r.start();
}
function compareSpeech(spoken){
const t=phEn.innerText.toLowerCase().split(" ");
const s=spoken.toLowerCase().split(" ");
let ok=0,html="";
t.forEach((w,i)=>{
if(s[i]===w){ok++;html+=`<span class="word-ok">${w}</span> `;}
else html+=`<span class="word-bad">${w}</span> `;
});
spResult.innerHTML=html;
spScore.innerText=`Accuracy: ${Math.round(ok/t.length*100)}%`;
}
function generateSpeak(){
loadPhrase();
spTarget.innerText=phEn.innerText;
spFig.innerText=phFig.innerText;
spResult.innerHTML="";
spScore.innerHTML="";
}

/* ================= EXERCISES ================= */
async function loadExercise(){
let s;
try{s=(await (await fetch("https://api.adviceslip.com/advice")).json()).slip.advice}catch{}
if(!s)s=phEn.innerText||"Learning English improves your confidence";
const w=s.split(" ");
const i=Math.floor(Math.random()*w.length);
const a=w[i];
w[i]="___";
exQ.innerText=w.join(" ");
exOpts.innerHTML="";
[a,"is","are","do","does"].sort(()=>Math.random()-0.5).forEach(o=>{
const d=document.createElement("div");
d.className="option";
d.innerText=o;
d.onclick=()=>d.classList.add(o===a?"correct":"wrong");
exOpts.appendChild(d);
});
}

/* INIT */
loadPhrase();
loadExercise();
</script>
<script>
/* =====================================================================
   ELITE ENGLISH PRO · SENTENCE ENGINE v7 (EXTREME ROBUST)
   =====================================================================
   ✔ 10+ fuentes reales de Internet
   ✔ Gemini prioritario
   ✔ Control por función
   ✔ Ultra estable
   ✔ Nunca devuelve vacío
===================================================================== */

/* =============================
   CONFIGURACIÓN GLOBAL
============================= */
const ENGINE_V7 = {
  minWords: 6,
  timeout: 7000,
  emergency: "English is a global language used in many real situations."
};

/* =============================
   UTILIDADES GENERALES
============================= */
const pick = a => a[Math.floor(Math.random() * a.length)];

function sanitize(text){
  return (text || "")
    .toString()
    .replace(/[\r\n]+/g," ")
    .replace(/[^a-zA-Z0-9\s.,!?']/g,"")
    .replace(/\s+/g," ")
    .trim();
}

function isValid(text){
  return text && text.split(" ").length >= ENGINE_V7.minWords;
}

async function safeFetch(fn){
  try{
    const controller = new AbortController();
    setTimeout(()=>controller.abort(), ENGINE_V7.timeout);
    return await fn(controller.signal);
  }catch{
    return null;
  }
}

/* =============================
   PRONUNCIACIÓN FIGURADA
============================= */
function englishToSpanishPhonetic(text){
  if(!text) return "";
  let t = sanitize(text.toLowerCase());

  const dict = {
    i:"ai", you:"iú", he:"jí", she:"shí", we:"uí", they:"déi",
    the:"da", is:"is", are:"ar", was:"uás", were:"uér",
    have:"jav", has:"jas", had:"jad",
    english:"ínglish", people:"pípol",
    work:"uórk", life:"láif", learning:"lérnin"
  };

  t = t.split(" ").map(w=>dict[w]||w).join(" ");

  [
    [/tion\b/g,"shon"],[/sion\b/g,"shon"],
    [/ph/g,"f"],[/ck/g,"k"],[/qu/g,"ku"],[/gh/g,""],
    [/th/g,"d"],[/ee/g,"í"],[/ea/g,"í"],[/oo/g,"ú"],
    [/ai/g,"ei"],[/ay/g,"ei"],[/ow/g,"au"],[/ou/g,"au"],
    [/ing\b/g,"in"],[/ed\b/g,"d"],[/ly\b/g,"li"]
  ].forEach(r=>t=t.replace(r[0],r[1]));

  return t;
}

/* =============================
   FUENTES DE INTERNET
============================= */

/* 1. Quotable */
async function srcQuotable(signal){
  const r = await fetch("https://api.quotable.io/random",{signal});
  return (await r.json()).content;
}

/* 2. AdviceSlip */
async function srcAdvice(signal){
  const r = await fetch("https://api.adviceslip.com/advice",{signal});
  return (await r.json()).slip.advice;
}

/* 3. Bored API */
async function srcBored(signal){
  const r = await fetch("https://www.boredapi.com/api/activity",{signal});
  const j = await r.json();
  return `When you have free time, ${j.activity.toLowerCase()}.`;
}

/* 4. Affirmations */
async function srcAffirmation(signal){
  const r = await fetch("https://www.affirmations.dev/",{signal});
  return (await r.json()).affirmation;
}

/* 5. Type.fit */
async function srcTypeFit(signal){
  const r = await fetch("https://type.fit/api/quotes",{signal});
  const j = await r.json();
  return pick(j)?.text;
}

/* 6. ZenQuotes */
async function srcZen(signal){
  const r = await fetch("https://zenquotes.io/api/random",{signal});
  const j = await r.json();
  return j[0]?.q;
}

/* 7. DummyJSON Quotes */
async function srcDummyQuotes(signal){
  const r = await fetch("https://dummyjson.com/quotes/random",{signal});
  return (await r.json()).quote;
}

/* 8. JokeAPI (adaptada) */
async function srcJoke(signal){
  const r = await fetch("https://v2.jokeapi.dev/joke/Any?type=single",{signal});
  const j = await r.json();
  return j.joke;
}

/* 9. Wikipedia summary */
async function srcWikipedia(signal){
  const topics = ["English language","Communication","Education","Travel"];
  const t = pick(topics);
  const r = await fetch(
    "https://en.wikipedia.org/api/rest_v1/page/summary/"+encodeURIComponent(t),
    {signal}
  );
  return (await r.json()).extract;
}

/* =============================
   GEMINI (PRIORIDAD ALTA)
============================= */
async function srcGemini(){
  const key = localStorage.getItem("GEMINI_KEY");
  if(!key) return null;

  const prompt = `
Write ONE original English sentence.
- Real life
- A2-B2
- Different structure every time
- No quotes
`;

  try{
    const r = await fetch(
      "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key="+key,
      {
        method:"POST",
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})
      }
    );
    const j = await r.json();
    return j?.candidates?.[0]?.content?.parts?.[0]?.text;
  }catch{
    return null;
  }
}

/* =============================
   MOTOR INTERNO (ÚLTIMO NIVEL)
============================= */
function semanticInternal(){
  const patterns = [
    () => `Many people realize the importance of English only after facing a real challenge.`,
    () => `Learning a language changes the way you see the world and communicate with others.`,
    () => `Confidence grows naturally when you practice speaking without fear of mistakes.`,
    () => `Some situations feel uncomfortable at first, but experience makes them easier.`,
    () => `Effective communication often matters more than perfect grammar.`
  ];
  return pick(patterns)();
}

/* =============================
   GENERADOR MAESTRO
============================= */
async function generateSentence(){
  const sources = [
    async()=>sanitize(await srcGemini()),
    async()=>sanitize(await safeFetch(srcQuotable)),
    async()=>sanitize(await safeFetch(srcAdvice)),
    async()=>sanitize(await safeFetch(srcBored)),
    async()=>sanitize(await safeFetch(srcAffirmation)),
    async()=>sanitize(await safeFetch(srcZen)),
    async()=>sanitize(await safeFetch(srcDummyQuotes)),
    async()=>sanitize(await safeFetch(srcTypeFit)),
    async()=>sanitize(await safeFetch(srcJoke)),
    async()=>sanitize(await safeFetch(srcWikipedia)),
    ()=>semanticInternal()
  ];

  for(const src of sources){
    try{
      const t = await src();
      if(isValid(t)) return t;
    }catch{}
  }

  return ENGINE_V7.emergency;
}

/* =============================
   API FINAL PARA LA APP
============================= */
async function getPhrase(){
  const text = await generateSentence();
  return { text, phonetic: englishToSpanishPhonetic(text) };
}

async function getSpeak(){
  const text = await generateSentence();
  return {
    text,
    phonetic: englishToSpanishPhonetic(text),
    clean: sanitize(text.toLowerCase())
  };
}

async function getExercise(){
  const text = await generateSentence();
  const words = text.split(" ");
  const i = Math.floor(Math.random()*words.length);
  const answer = words[i];
  words[i] = "___";

  return {
    question: words.join(" "),
    answer,
    options: [answer,"is","are","do","does","can","have"]
      .sort(()=>Math.random()-0.5)
      .slice(0,4)
  };
}

console.log("✅ Sentence Engine v7 loaded · EXTREME MULTI-SOURCE");
</script>
</body>
</html>
